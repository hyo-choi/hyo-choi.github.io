<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
    [Unity] 씬 전환시 BGM과 UI 유지하기 &middot; hyo-choi
    
  </title>

  
  <link rel="canonical" href="https://hyo-choi.github.io/study/study/unity/2021/03/04/how-to-keep-BGM-and-UI/">
  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://hyo-choi.github.io/public/css/poole.css">
  <link rel="stylesheet" href="https://hyo-choi.github.io/public/css/syntax.css">
  <link rel="stylesheet" href="https://hyo-choi.github.io/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <link rel="apple-touch-icon-precomposed" sizes="144x144"
    href="https://hyo-choi.github.io/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="https://hyo-choi.github.io/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://hyo-choi.github.io/atom.xml">

  
</head>


  <body class="theme-base-0d sidebar-overlay">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="https://hyo-choi.github.io/">Home</a>

    

    <div class="site-category">
      <li style="list-style:none;" class="sidebar-nav-item"><a href="/PROJECTS">#PROJECTS</a>
        <ul style="padding-left: 15px;">
          <li style="list-style:none;"><a href="/PROJECTS/to-do-list">to-do list</a></li>
        </ul>
      </li>

      <li style="list-style:none;" class="sidebar-nav-item"><a href="/STUDY">#STUDY</a>
        <ul style="padding-left: 15px;">
          <li style="list-style:none;"><a href="/STUDY/CPP">C++</a></li>
          <li style="list-style:none;"><a href="/STUDY/HTML">HTML</a></li>
          <li style="list-style:none;"><a href="/STUDY/CSS">CSS</a></li>
          <li style="list-style:none;"><a href="/STUDY/Javascript">Javascript</a></li>
          <li style="list-style:none;"><a href="/STUDY/Unity">Unity</a></li>
          <li style="list-style:none;"><a href="/STUDY/Etc">Etc</a></li>
        </ul>
      </li>
    </div>

    <a class="sidebar-nav-item" href="https://github.com/hyo-choi" target="_blank">GitHub</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2021. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">hyo-choi</a>
            <small>공부하는 블로그</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">[Unity] 씬 전환시 BGM과 UI 유지하기</h1>
  <span class="post-date">04 Mar 2021</span>
  <p>유튜브에서 유니티 튜토리얼을 따라하며 공부하다가 BGM을 추가해보고 싶어졌다. 그런데 GameObject로 BGMManager를 각 씬에 넣어줬더니 BGM이 이어지지 않고 씬마다 각각 재생되었다. 같은 BGM을 샘플 게임 내내 유지하고 싶었기 때문에 해결 방법을 찾아보았다.</p>

<p><br /></p>
<h2 id="씬-전환-시-오브젝트-유지하기">씬 전환 시 오브젝트 유지하기</h2>

<h3 id="dontdestroyonload">DontDestroyOnLoad</h3>

<p>DontDestroyOnLoad(GameObject)는 다른 씬으로 넘어갈 때 파괴하지 않고 유지할 오브젝트에 사용할 수 있다. 주의할 점은 DontDestroyOnLoad를 어떤 오브젝트의 하위 오브젝트에 설정하면 <code class="language-plaintext highlighter-rouge">DontDestroyOnLoad only works for root GameObjects or components on root GameObjects.</code> 라는 워닝을 보게 된다는 것이다. 주의 문구대로 루트 오브젝트, 혹은 루트 오브젝트의 컴포넌트에만 해당 함수를 적용하도록 하자.</p>

<p>또, 해당 오브젝트를 Destroy하지 않는 이상 이어지는 모든 씬에 존재하게 되므로 BGM 오브젝트와 같이 중복되면 안 되는 경우 다른 씬의 중복은 제거해주어야 한다.</p>

<ul>
  <li>적용 예시</li>
</ul>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">Awake</span><span class="p">()</span> <span class="c1">// playOnAwake는 설정하지 않았음</span>
<span class="p">{</span>
	<span class="n">BGMManager</span> <span class="p">=</span> <span class="n">gameObject</span><span class="p">;</span>
	<span class="n">bgm</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">AudioSource</span><span class="p">&gt;();</span>
	<span class="nf">pauseAndPlay</span><span class="p">();</span>
	<span class="nf">DontDestroyOnLoad</span><span class="p">(</span><span class="n">BGMManager</span><span class="p">);</span> <span class="c1">// 여기!</span>
<span class="p">}</span>
</code></pre></div></div>

<p><br /></p>
<h3 id="bgm-오브젝트와-연동된-ui도-함께-유지하기">BGM 오브젝트와 연동된 UI도 함께 유지하기</h3>

<p>위 방법을 통해 다음 씬으로 전환될 때에도 BGM이 끊기지 않도록 설정하였다. 여기서 좀 더 디벨롭하여 BGM의 재생/정지 버튼을 만들어 임의로 조정할 수 있게 하고 싶었는데, Canvas에 버튼 UI를 넣어두니 씬이 전환될 때마다 DontDestroyOnLoad 처리해둔 BGMManager와 제대로 연결이 되지 않았다.</p>

<p>이 문제는 어떻게 해결할 수 있을지 몰라 한참을 헤맸는데, 웬걸 굉장히 간단하게 해결할 수 있는 문제였다.</p>

<p>Canvas 오브젝트는 루트 오브젝트여야 하고 UI 요소들은 해당 Canvas 안에만 있을 수 있다고 생각했는데, 생각해보니 Canvas를 BGMManager의 하위 오브젝트로 추가할 수 있었다. 그래서 이렇게 BGMManager의 하위에 Canvas를, 그 하위에 재생/정지를 처리해줄 버튼 오브젝트를 추가해주었다.</p>

<p align="center">
<img src="/assets/images/2021-03-04-how-to-keep-BGM-and-UI_1.png" width="200px" alt="Hierarchy image" /> 
</p>
<p>그러자 UI도 DontDestroyOnLoad의 영향을 받아 씬 전환시에 유지되며 BGM과의 연결도 끊어지지 않아 의도한 동작대로 잘 처리되었다.</p>

<p>이 경우에도 Destroy 전까지는 버튼이 모든 씬에서 출력되므로 꼭! 중복되는 버튼은 제거해주도록 한다. 왜 이 말을 두 번이나 쓰냐면 루트 Canvas 오브젝트에 추가해두었던 플레이 버튼을 안 지워서 구현이 제대로 안 된 줄 알고 1시간쯤 삽질했기 때문이다…….</p>

<ul>
  <li>해당 부분 코드</li>
</ul>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">Awake</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">BGMManager</span> <span class="p">=</span> <span class="n">gameObject</span><span class="p">;</span>
	<span class="n">bgm</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">AudioSource</span><span class="p">&gt;();</span>
	<span class="n">playButton</span> <span class="p">=</span> <span class="n">GetComponentInChildren</span><span class="p">&lt;</span><span class="n">Button</span><span class="p">&gt;();</span>
	<span class="n">playButtonText</span> <span class="p">=</span> <span class="n">playButton</span><span class="p">.</span><span class="n">GetComponentInChildren</span><span class="p">&lt;</span><span class="n">Text</span><span class="p">&gt;();</span>
	<span class="nf">pauseAndPlay</span><span class="p">();</span>
	<span class="nf">DontDestroyOnLoad</span><span class="p">(</span><span class="n">BGMManager</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">void</span> <span class="nf">pauseAndPlay</span><span class="p">()</span> <span class="c1">// inspector에서 버튼의 onClick과 연동해두었음</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">bgm</span><span class="p">.</span><span class="n">isPlaying</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">playButtonText</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">"▶︎"</span><span class="p">;</span>
		<span class="n">bgm</span><span class="p">.</span><span class="nf">Pause</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="n">playButtonText</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">"❚❚"</span><span class="p">;</span>
		<span class="n">bgm</span><span class="p">.</span><span class="nf">Play</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p align="center">
<img src="/assets/images/2021-03-04-how-to-keep-BGM-and-UI_2.png" width="100%" alt="Game screenshot" /> 
완성한 샘플 게임 이미지
</p>
<p>이렇게 BGM과 UI 처리를 할 수 있었다. DontDestroyOnLoad는 종종 쓰이게 될 것 같으므로 잘 기억해두는 것이 좋겠다.</p>

</div>


<div class="related">
  <h2>Related posts</h2>
  <ul class="related-posts">
    
    <li>
      <h3>
        <a href="/study/study/cpp/2021/03/08/CPP-RAII-class/">
          [C++] 자원 관리 클래스
          <small>08 Mar 2021</small>
        </a>
      </h3>
    </li>
    
    <li>
      <h3>
        <a href="/study/study/css/2021/03/04/linear-gradient-and-body-problem/">
          [CSS] linear-gradient와 body 적용시 문제 해결
          <small>04 Mar 2021</small>
        </a>
      </h3>
    </li>
    
    <li>
      <h3>
        <a href="/projects/projects/to-do-list/2021/03/04/to-do-list-plan/">
          [to-do list] 계획
          <small>04 Mar 2021</small>
        </a>
      </h3>
    </li>
    
  </ul>
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
